# =====================================================
# GitHub Actions Workflow for Netlify Deployment
# =====================================================
# This workflow automatically deploys the static site to Netlify
# when you push to the main branch.
#
# Required GitHub Secrets:
#   - NETLIFY_AUTH_TOKEN: Personal access token from Netlify
#   - NETLIFY_SITE_ID: Site ID from Netlify dashboard
#
# Setup instructions:
#   1. Get NETLIFY_AUTH_TOKEN from: https://app.netlify.com/user/applications/personal-access-tokens
#   2. Get NETLIFY_SITE_ID from: https://app.netlify.com → Site settings → General → Site ID
#   3. Add both to GitHub Secrets: Settings → Secrets and variables → Actions → New repository secret

name: Deploy to Netlify

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Deploy to Netlify Production
    
    steps:
      # Checkout code from repository
      - name: Checkout code
        uses: actions/checkout@v4
      
      # Validate critical files exist
      - name: Validate project structure
        run: |
          echo "Validating critical files..."
          test -f "index.html" && echo "✓ index.html found" || (echo "✗ index.html missing" && exit 1)
          test -f "contact.html" && echo "✓ contact.html found" || (echo "✗ contact.html missing" && exit 1)
          test -d "css" && echo "✓ css/ directory found" || (echo "✗ css/ directory missing" && exit 1)
          test -d "js" && echo "✓ js/ directory found" || (echo "✗ js/ directory missing" && exit 1)
          test -f "forms.js" && echo "✓ forms.js found" || (echo "✗ forms.js missing" && exit 1)
          echo ""
          echo "All critical files validated! ✓"
      
      # Deploy to Netlify using netlify-cli action
      - name: Deploy to Netlify
        uses: nwtgck/actions-netlify@v2.1
        with:
          publish-dir: '.'
          production-branch: main
          github-token: ${{ secrets.GITHUB_TOKEN }}
          deploy-message: 'Deployment from GitHub Actions - ${{ github.sha }}'
          enable-pull-request-comment: false
          enable-commit-comment: false
          overwrites-pull-request-comment: false
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
        timeout-minutes: 5

      # Log deployment completion
      - name: Deployment Complete
        run: |
          echo "✓ Deployment to Netlify completed successfully!"
          echo "Site URL: https://${{ secrets.NETLIFY_SITE_ID }}.netlify.app"
          echo ""
          echo "View deployment logs at:"
          echo "https://app.netlify.com/sites/${{ secrets.NETLIFY_SITE_ID }}/deploys"

  # Optional: Validate HTML/CSS/JS (commented out - can enable later)
  # validate:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v4
  #     - name: Setup Node.js
  #       uses: actions/setup-node@v4
  #       with:
  #         node-version: '18'
  #     - name: Install html-validate
  #       run: npm install -g html-validate
  #     - name: Validate HTML files
  #       run: html-validate "*.html"
